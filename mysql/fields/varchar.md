# varchar

1. `varchar`支持最大的长度是`65535`，实际上通过测试支持最大长度为`65532`。
2. 如果数据库此时是非严格模式，创建长度为`65535`可以成功，原因就是`VARCHAR`类型被转成了`TEXT`。
3. `VARCHAR(N)`中的`N`指的是字符的长度，文档中说明`VARCHAR`类型最大支持`65535`，单位是字节。
4. 官方手册定义的`65535`长度是指所有`VARCHAR`列的长度总和，如果超过依旧无法创建。
5. 数据量比较大的情况下，数据页其实只保存了`VARCHAR(65532)`的前`768`字节的前缀数据，之后是偏移量，指向行溢出页。这里可以解释`string`的前缀索引。

## 问题

### 1. 多长的`VARCHAR`是保存在单个数据页中的？

InnoDB存储表是索引组织的，即`B+Tree`的结构，这样的页中至少应该有两条行记录（否则就失去了B+Tree的意义，变成链表了）。因此，如果一个页只能放下一条记录，那么InnoDB存储引擎会自动将行数据存放到溢出页中。但是，如果可以在一个页中至少放入两行数据，那么`VARCHAR`类型的数据就不会存放到`BLOB`页中，经过多次测试，发现这个阈值是`8098`（`VARCHAR(8098)`）。
