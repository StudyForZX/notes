# 索引

## 自适应哈希索引

全名：Adaptive Hash Index（AHI）

InnoDB存储引擎会监控对表上各索引页的查询。如果观察到建立哈希索引可以带来速度提升，则建立哈希索引，称之为自适应哈希索引。

AHI是通过缓冲池的B+树页构造而来，因此建立的速度很快，而且不需要对整张表结构建立哈希索引。InnoDB存储引擎会自动根据访问的频率和模式来自动地为某些热点页建立哈希索因。

AHI有以下要求：

1. 即对这个页的连续访问模式必须是一样的。访问模式一样指的是查询的条件是一样的，若要交替进行下列查询，那么不会对该页构造AHI。
2. 以该模式访问了100次。
3. 页通过该模式访问了N次，其中N=页中记录 * 1/16

```mysql
-- 要求1解释
-- 可以构造
... WHERE a = xxx
... WHERE a = xxx AND b = xxx

-- 不可构造
... WHERE a = xxx AND b = xxx
... WHERE a = xxx
```

### 启用AHI的优化提升

1. 读取与写入速度可以提高2倍。
2. 辅助索引的连接操作性能可以提高5倍。

总结：AHI是非常好的优化模式，其设计思想是数据库自优化（self-running）的，无需人为调整。
