# 插入缓冲

## 两次写

如果说`Insert Buffer`带给InnoDB存储引擎的是性能上的提升，那么`doublewrite`带给InnoDB存储引擎的数据页的可靠性。

当发生数据库宕机时，可能InnoDB存储引擎正在写入某个页到表中，而这个页只写了一部分，比如16KB的页，只写了前4KB，之后就发生了宕机，这种情况被称为部分失效。在InnoDB采用双写技术前，曾经出现过因为部分写失效而导致数据丢失的情况。

如果发生写失效，可以通过重做日志进行恢复。这是一个办法。

但是必须清楚地认识到，重做日志中记录的是对页的物理操作，如偏移量800，写'aaa'这个记录。如果这个页本身已经发生了损坏，再对其进行重做是没有意义的。这就是说，在应用重做日志前，用户需要一个页的副本，当写入失效发生时，先通过页的副本来还原该页，再进行重做，这就是双写。
